<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–ø–ª–∞—Ç–∞ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .form-wrapper {
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(34, 139, 34, 0.1);
            border: 1px solid #e0f0e0;
            overflow: hidden;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e8f5e8;
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .data-label {
            font-weight: 600;
            color: #2d5016;
            flex: 1;
        }
        
        .data-value {
            color: #4a7c2a;
            flex: 2;
            text-align: right;
            font-weight: 500;
        }
        
        #payment-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 18px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        #payment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            background: linear-gradient(135deg, #45a049 0%, #4CAF50 100%);
        }
        
        #payment-btn:disabled {
            background: #cccccc;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .member-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 25px;
            background: linear-gradient(135deg, #2E7D32 0%, #4CAF50 100%);
            color: white;
            border-radius: 0 0 20px 20px;
            position: relative;
            overflow: hidden;
        }
        
        .member-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path fill="white" d="M50 20L60 40H40L50 20Z M30 60L50 40L70 60L50 80Z"/></svg>');
            background-size: 80px;
        }
        
        .search-section {
            text-align: center;
            padding: 50px 30px;
            background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%);
            border-radius: 15px;
            margin: 20px;
            border: 2px dashed #c8e6c9;
        }
        
        .search-input {
            padding: 15px;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            width: 100%;
            margin-bottom: 20px;
            font-size: 16px;
            background: #ffffff;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #2E7D32;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .active {
            display: block;
        }
        
        .success-badge {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.3);
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e8f5e8;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .info-box {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .house-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
        }
        
        .leaf-icon {
            color: #4CAF50;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="payment-page" class="form-wrapper">
            
            <!-- –ë–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div id="loading-section" class="section active">
                <div style="text-align: center; padding: 60px 20px;">
                    <div class="loading-spinner"></div>
                    <h2 style="color: #2d5016; margin-bottom: 15px;">–ò—â–µ–º –≤–∞—à –Ω–æ–º–µ—Ä —á–ª–µ–Ω–∞ –∫–ª—É–±–∞</h2>
                    <p style="color: #4a7c2a;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ –ø–æ–∏—Å–∫–∞ -->
            <div id="search-section" class="section search-section">
                <div class="house-icon">üè°</div>
                <h3 style="color: #2d5016; margin-bottom: 15px;">–ù–∞–π–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —á–ª–µ–Ω–∞ –∫–ª—É–±–∞</h3>
                <p style="color: #4a7c2a; margin-bottom: 25px;">–í–≤–µ–¥–∏—Ç–µ email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —É–∫–∞–∑—ã–≤–∞–ª–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
                
                <div style="max-width: 300px; margin: 0 auto;">
                    <input type="text" id="search-input" placeholder="Email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω" class="search-input">
                    <button onclick="findMemberNumber()" class="search-btn">
                        üåø –ù–∞–π—Ç–∏ –Ω–æ–º–µ—Ä
                    </button>
                </div>
                
                <div class="info-box" style="margin-top: 25px;">
                    <p style="margin: 0; color: #2d5016; font-size: 14px;">
                        <span class="leaf-icon">üå±</span>
                        –í–∞—à –Ω–æ–º–µ—Ä —á–ª–µ–Ω–∞ –∫–ª—É–±–∞ - —ç—Ç–æ –∫–ª—é—á –∫ —É—á–∞—Å—Ç–∏—é –≤ –Ω–∞—à–µ–º —Å–æ–æ–±—â–µ—Å—Ç–≤–µ.
                    </p>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div id="user-section" class="section">
                <div class="member-header">
                    <div class="success-badge">‚úÖ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –£–°–ü–ï–®–ù–ê</div>
                    <h2 style="margin: 0 0 15px 0; font-size: 24px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ!</h2>
                    <div style="font-size: 16px; margin-bottom: 10px; opacity: 0.9;">–í–∞—à –Ω–æ–º–µ—Ä —á–ª–µ–Ω–∞ –∫–ª—É–±–∞:</div>
                    <div id="member-number" style="font-size: 32px; font-weight: bold; letter-spacing: 2px; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">-</div>
                </div>
                
                <div style="background: white; padding: 30px 25px; margin: 0 20px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(46, 125, 50, 0.1); border: 1px solid #e8f5e8;">
                    <h3 style="color: #2d5016; margin-bottom: 25px; border-bottom: 2px solid #4CAF50; padding-bottom: 12px; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">üìã</span>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
                    </h3>
                    
                    <div class="data-row">
                        <div class="data-label">üë§ –§–ò–û:</div>
                        <div id="user-fullname" class="data-value">-</div>
                    </div>
                    
                    <div class="data-row">
                        <div class="data-label">üìß Email:</div>
                        <div id="user-email" class="data-value">-</div>
                    </div>
                    
                    <div class="data-row">
                        <div class="data-label">üìû –¢–µ–ª–µ—Ñ–æ–Ω:</div>
                        <div id="user-phone" class="data-value">-</div>
                    </div>
                    
                    <div class="data-row">
                        <div class="data-label">üèôÔ∏è –ì–æ—Ä–æ–¥:</div>
                        <div id="user-city" class="data-value">-</div>
                    </div>
                </div>

                <!-- –ë–ª–æ–∫ –æ–ø–ª–∞—Ç—ã -->
                <div style="margin: 30px 20px; text-align: center;">
                    <div style="padding: 25px; background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%); border-radius: 12px; margin-bottom: 25px; border: 1px solid #c8e6c9;">
                        <p style="margin: 0; color: #2d5016; font-size: 16px; font-weight: 500;">
                            üèóÔ∏è –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—á–∞–ª–∞ —É—á–∞—Å—Ç–∏—è –æ–ø–ª–∞—Ç–∏—Ç–µ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å
                        </p>
                    </div>
                    <button id="payment-btn">
                        üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        const API_BASE = 'https://npkvdv.ru';
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const AppState = {
            currentUser: null,
            currentMemberNumber: null
        };
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
        
        function initializeApp() {
            // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('payment-btn').addEventListener('click', createPayment);
            
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        findMemberNumber();
                    }
                });
                
                // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                setTimeout(() => {
                    searchInput.focus();
                }, 500);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL
            checkUrlParameters();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
            showSection('search-section');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
        function checkUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const memberNumber = urlParams.get('memberNumber');
            const email = urlParams.get('email');
            const phone = urlParams.get('phone');
            
            if (memberNumber) {
                // –ï—Å–ª–∏ memberNumber –≤ URL, —Å—Ä–∞–∑—É –∏—â–µ–º
                findMemberByNumber(memberNumber);
            } else if (email || phone) {
                // –ï—Å–ª–∏ email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –≤ URL
                document.getElementById('search-input').value = email || phone;
                setTimeout(() => findMemberNumber(), 100);
            }
        }
        
        // –ü–æ–∏—Å–∫ –Ω–æ–º–µ—Ä–∞ —á–ª–µ–Ω–∞ –∫–ª—É–±–∞ –ø–æ email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É
        async function findMemberNumber() {
            const searchInput = document.getElementById('search-input');
            const searchValue = searchInput.value.trim();
            
            if (!searchValue) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω', 'error');
                searchInput.focus();
                return;
            }
            
            try {
                showLoading(true);
                clearMessages();
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≤–≤–æ–¥–∞
                const isEmail = searchValue.includes('@');
                const paramName = isEmail ? 'email' : 'phone';
                const url = `${API_BASE}/get-member-number?${paramName}=${encodeURIComponent(searchValue)}`;
                
                console.log('üîç –ó–∞–ø—Ä–æ—Å –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                
                if (data.success) {
                    AppState.currentUser = data.userData || {};
                    AppState.currentMemberNumber = data.memberNumber;
                    
                    displayUserData(data);
                    showSection('user-section');
                    showMessage('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω!', 'success');
                } else {
                    throw new Error(data.error || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
                
                let errorMessage = '–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ';
                if (error.message.includes('404') || error.message.includes('–Ω–µ –Ω–∞–π–¥–µ–Ω')) {
                    errorMessage += '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.';
                } else if (error.message.includes('network') || error.message.includes('Network')) {
                    errorMessage += '–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.';
                } else {
                    errorMessage += error.message;
                }
                
                showMessage(errorMessage, 'error');
                searchInput.focus();
                searchInput.select();
                
            } finally {
                showLoading(false);
            }
        }
        
        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –Ω–æ–º–µ—Ä—É —É—á–∞—Å—Ç–Ω–∏–∫–∞
        async function findMemberByNumber(memberNumber) {
            if (!memberNumber) return;
            
            try {
                showLoading(true);
                clearMessages();
                
                const url = `${API_BASE}/api/paymentfee?memberNumber=${encodeURIComponent(memberNumber)}`;
                console.log('üîç –ó–∞–ø—Ä–æ—Å –ø–æ –Ω–æ–º–µ—Ä—É —É—á–∞—Å—Ç–Ω–∏–∫–∞:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                
                if (data.success) {
                    AppState.currentUser = data.user || {};
                    AppState.currentMemberNumber = memberNumber;
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    document.getElementById('member-number').textContent = memberNumber;
                    document.getElementById('user-fullname').textContent = data.user?.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                    document.getElementById('user-email').textContent = data.user?.email || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                    document.getElementById('user-phone').textContent = data.user?.phone || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                    document.getElementById('user-city').textContent = data.user?.city || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                    
                    showSection('user-section');
                    showMessage('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω –ø–æ –Ω–æ–º–µ—Ä—É —É—á–∞—Å—Ç–Ω–∏–∫–∞!', 'success');
                } else {
                    throw new Error(data.error || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–æ–º–µ—Ä—É:', error);
                showMessage(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω–æ–º–µ—Ä–æ–º "${memberNumber}"`, 'error');
                
            } finally {
                showLoading(false);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function displayUserData(data) {
            const userData = data.userData || {};
            
            document.getElementById('member-number').textContent = data.memberNumber || '–ù–µ —É–∫–∞–∑–∞–Ω';
            document.getElementById('user-fullname').textContent = userData.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('user-email').textContent = userData.email || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('user-phone').textContent = userData.phone || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('user-city').textContent = userData.city || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            AppState.currentUser = userData;
            AppState.currentMemberNumber = data.memberNumber;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
        async function createPayment() {
            if (!AppState.currentMemberNumber) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
                return;
            }
            
            const paymentBtn = document.getElementById('payment-btn');
            const originalText = paymentBtn.textContent;
            
            try {
                // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                paymentBtn.disabled = true;
                paymentBtn.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞...';
                showLoading(true);
                clearMessages();
                
                console.log('üí≥ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è:', AppState.currentMemberNumber);
                
                const response = await fetch(`${API_BASE}/create-payment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        memberNumber: AppState.currentMemberNumber,
                        userData: AppState.currentUser
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                console.log('üì• –û—Ç–≤–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞:', result);
                
                if (result.success && result.paymentUrl) {
                    showMessage('–ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...', 'success');
                    
                    // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                    setTimeout(() => {
                        window.location.href = result.paymentUrl;
                    }, 1000);
                    
                } else {
                    throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞:', error);
                
                let errorMessage = '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞: ';
                if (error.message.includes('network') || error.message.includes('Network')) {
                    errorMessage += '–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.';
                } else if (error.message.includes('payment') || error.message.includes('–ü–ª–∞—Ç–µ–∂')) {
                    errorMessage += error.message.replace('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞: ', '');
                } else {
                    errorMessage += '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.';
                }
                
                showMessage(errorMessage, 'error');
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                paymentBtn.disabled = false;
                paymentBtn.textContent = originalText;
                
            } finally {
                showLoading(false);
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å–µ–∫—Ü–∏–π
        function showSection(sectionId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
        function showLoading(show) {
            const loadingSection = document.getElementById('loading-section');
            if (loadingSection) {
                loadingSection.classList.toggle('active', show);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type = 'info') {
            const messageDiv = document.getElementById('message') || createMessageElement();
            
            messageDiv.textContent = text;
            messageDiv.className = `message message-${type}`;
            messageDiv.style.display = 'block';
            
            // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ –¥–ª—è success –∏ info —Å–æ–æ–±—â–µ–Ω–∏–π
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
        function clearMessages() {
            const messageDiv = document.getElementById('message');
            if (messageDiv) {
                messageDiv.style.display = 'none';
            }
        }
        
        // –°–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
        function createMessageElement() {
            const div = document.createElement('div');
            div.id = 'message';
            div.style.cssText = `
                padding: 12px 16px;
                margin: 16px 0;
                border-radius: 4px;
                font-weight: 500;
                display: none;
            `;
            document.querySelector('.container').prepend(div);
            return div;
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
        window.findMemberNumber = findMemberNumber;
        window.createPayment = createPayment;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
        const style = document.createElement('style');
        style.textContent = `
            .message {
                padding: 12px 16px;
                margin: 16px 0;
                border-radius: 4px;
                font-weight: 500;
                transition: all 0.3s ease;
            }
            .message-success {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .message-error {
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            .message-info {
                background-color: #d1ecf1;
                color: #0c5460;
                border: 1px solid #bee5eb;
            }
            .message-warning {
                background-color: #fff3cd;
                color: #856404;
                border: 1px solid #ffeaa7;
            }
            .section {
                display: none;
                opacity: 0;
                transform: translateY(10px);
                transition: all 0.3s ease;
            }
            .section.active {
                display: block;
                opacity: 1;
                transform: translateY(0);
            }
            .loading-spinner {
                border: 3px solid #f3f3f3;
                border-top: 3px solid #007bff;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 20px auto;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            #search-input:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
            }
            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>